# AlemonJS Github Dynamic Bot

- ä»“åº“åŠ¨æ€æœºå™¨äººï¼Œå¯ä»¥è‡ªåŠ¨æ¨é€Githubä»“åº“çš„åŠ¨æ€åˆ°OneBotå¹³å°ã€‚

## ğŸš©è¿è¡Œç¯å¢ƒï¼š

- node v22+ ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/zh-cn/download/

- Redis 6+ ä¸‹è½½åœ°å€ï¼šhttps://redis.io/download

- å®‰è£…chromeæˆ–chromiumæµè§ˆå™¨ï¼Œå…¶ä»–æµè§ˆå™¨å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚

1. chrome æµè§ˆå™¨ v131+ win_x64ä¸‹è½½åœ°å€ï¼šhttps://www.google.cn/chrome/
2. chromium æµè§ˆå™¨ v128+ Linux/winæ‰‹åŠ¨ä¸‹è½½å®‰è£…ï¼šhttps://download-chromium.appspot.com

> ç¤ºä¾‹linuxå‘½ä»¤è¡Œå®‰è£…chromiunæµè§ˆå™¨ï¼š

```sh
sudo apt-get install chromium-browser # Ubuntu/Debian
sudo dnf install chromium # Fedora
sudo yum install chromium # CentOS Stream 8
```

## æ‹‰å–ä»“åº“

```sh
git clone https://github.com/lemonade-lab/subscribe-code.git
```

```sh
# release ç‰ˆ
git clone -b release https://github.com/lemonade-lab/subscribe-code.git
```

## ä¸€ã€ğŸ„é…ç½®Github Webhook

> [!IMPORTANT]
> éœ€åæ–‡botæŒ‡ä»¤è®¢é˜…githubä»“åº“é…åˆä½¿ç”¨ã€‚

- è¿›å…¥Githubä»“åº“ï¼Œç‚¹å‡»`Settings` -> `Webhooks` -> `Add webhook`

- Payload URLï¼š`http://[ip]:[port]/github/webhook`

- Content typeï¼š`application/json`

- Secretï¼š`subscribe-code`(å¯è‡ªå®šä¹‰)

- æŒ‰éœ€é€‰æ‹©æ¨é€äº‹ä»¶ï¼š

    - Just the push event.
    - Send me everything.
    - Let me select individual events.

- æš‚æœªå®ç°SSL verificationï¼š

    - [âˆš] disable SSL verification

- ç‚¹å‡»`Add webhook`

## äºŒã€ğŸš€é…ç½®å¯åŠ¨bot

æ–‡æ¡£ï¼š [https://alemonjs.com/](https://alemonjs.com/)

æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶`alemomn.config.yaml`ï¼š

```yaml
onebot:
    url: '' # æ­£å‘url
    token: '' # access_token
    master_key: null # ä¸»äººid, æ¶ˆæ¯æ˜¾ç¤ºçš„çš„UserKey
alemonjs-code:
    # é…ç½®Github Webhook Secret
    github_secret: 'subscribe-code' # Github Webhook Secretï¼Œéœ€ä¸Github Webhooké…ç½®æ—¶å¡«å†™çš„ä¸€è‡´
```

> redis ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œè‹¥ä¿®æ”¹ï¼Œè¯·é˜…è¯»æ–‡æ¡£ @alemonjs/db

- è¿è¡Œ

```sh
# å¯åŠ¨æœºå™¨äºº
yarn dev --login onebot
# release ç‰ˆ
yarn app --login onebot
```

## ä¸‰ã€ğŸ’è®¢é˜…githuä»“åº“

> [!IMPORTANT]
> å½“å‰ä»…ä»…æ”¯æŒè¿è¡Œåœ¨onebotåè®®
> éœ€ä¸é…ç½®Github Webhookéƒ¨åˆ†é…åˆä½¿ç”¨ã€‚

- å¯åŠ¨botåï¼Œåœ¨ç¾¤èŠ/ç§èŠä¸­å‘é€æŒ‡ä»¤

### æŒ‡ä»¤æƒé™è¯´æ˜

| æ“ä½œç±»å‹     | ä¸»äºº | å…¨å±€ç®¡ç†å‘˜ | ç®¡ç†å‘˜ | ç™½åå•ç”¨æˆ· | æ™®é€šç”¨æˆ· |
| ------------ | ---- | ---------- | ------ | ---------- | -------- |
| ä»“åº“æ± ç®¡ç†   | âœ“    | âœ“          | âœ“      | âœ—          | âœ—        |
| ç¾¤ç»„è®¢é˜…ç®¡ç† | âœ“    | âœ“          | âœ“      | âœ—          | âœ—        |
| è·¨ç¾¤ç»„ç®¡ç†   | âœ“    | âœ“          | âœ—      | âœ—          | âœ—        |
| æŸ¥çœ‹ç¾¤ç»„è®¢é˜… | âœ“    | âœ“          | âœ“      | âœ“          | âœ“        |
| ç§äººè®¢é˜…ç®¡ç† | âœ—    | âœ—          | âœ—      | âœ“ (ä»…è‡ªå·±) | âœ—        |
| æƒé™ç®¡ç†     | âœ“    | âœ—          | âœ—      | âœ—          | âœ—        |
| æŸ¥çœ‹è‡ªèº«æƒé™ | âœ“    | âœ“          | âœ“      | âœ“          | âœ“        |

### æŒ‡ä»¤åˆ—è¡¨

- å‘èŠå¤©æœºå™¨äººå‘é€`!ä»“åº“å¸®åŠ©`å³å¯æŸ¥çœ‹

| ç”¨é€”                 | æƒé™è¦æ±‚           | æŒ‡ä»¤ç¤ºä¾‹ï¼ˆä¸­æ–‡ï¼‰                        | æŒ‡ä»¤ç¤ºä¾‹ï¼ˆè‹±æ–‡ï¼‰                        | è¯´æ˜                   |
| -------------------- | ------------------ | --------------------------------------- | --------------------------------------- | ---------------------- |
| **å…¬å…±æŒ‡ä»¤**         |                    |                                         |                                         |                        |
| æŸ¥çœ‹å½“å‰ä»“åº“åˆ—è¡¨     | æ‰€æœ‰äºº             | `!ä»“åº“åˆ—è¡¨`                             | `/codes-list` æˆ– `/codes-l`             | æŸ¥çœ‹å½“å‰èŠå¤©è®¢é˜…       |
| æŸ¥çœ‹è‡ªèº«æƒé™         | æ‰€æœ‰äºº             | `!æˆ‘çš„ä»“åº“æƒé™`                         | `/code-permission` æˆ– `/code-p`         | æŸ¥çœ‹è‡ªèº«æƒé™           |
| æ£€æŸ¥ä»“åº“çŠ¶æ€         | æ‰€æœ‰äºº             | `!æ£€æŸ¥ä»“åº“ github.com/user/repo`        | `/codes-check repoUrl`                  | é€šè¿‡URLæ£€æŸ¥è®¢é˜…çŠ¶æ€    |
| æ£€æŸ¥ç´¢å¼•ä»“åº“         | æ‰€æœ‰äºº             | `!æ£€æŸ¥ç´¢å¼•ä»“åº“ abcd`                    | `/codesrid-check repoId`                | é€šè¿‡ä»“åº“IDæ£€æŸ¥çŠ¶æ€     |
| è·å–å¸®åŠ©             | æ‰€æœ‰äºº             | `!ä»“åº“å¸®åŠ©`                             | `/code-help` æˆ– `/codeh`                | æ˜¾ç¤ºæŒ‡ä»¤å¸®åŠ©           |
| **ç§äººè®¢é˜…ç®¡ç†**     |                    |                                         |                                         |                        |
| æ·»åŠ ç§äººè®¢é˜…         | ç™½åå•ç”¨æˆ·(ä»…è‡ªå·±) | `!è®¢é˜…ä»“åº“ repoUrl`                     | `/codes-sub repoUrl`                    | ä»…é™ç§èŠä½¿ç”¨           |
| åˆ é™¤ç§äººè®¢é˜…         | ç™½åå•ç”¨æˆ·(ä»…è‡ªå·±) | `!å–æ¶ˆè®¢é˜…ä»“åº“ repoUrl`                 | `/codes-del repoUrl`                    | ä»…é™ç§èŠä½¿ç”¨           |
| **ä»“åº“æ± ç®¡ç†**       |                    |                                         |                                         |                        |
| æ·»åŠ ä»“åº“åˆ°ä»“åº“æ±      | ä¸»äºº/ç®¡ç†å‘˜        | `!æ·»åŠ ä»“åº“æ±  repoUrl`                   | `/codep-add repoUrl`                    | å°†ä»“åº“æ·»åŠ åˆ°å…±äº«ä»“åº“æ±  |
| ç§»é™¤ä»“åº“æ± ä»“åº“       | ä¸»äºº/ç®¡ç†å‘˜        | `!ç§»é™¤ä»“åº“æ±  repoUrl`                   | `/codep-del repoUrl`                    | é€šè¿‡URLç§»é™¤            |
| ç§»é™¤ç´¢å¼•ä»“åº“         | ä¸»äºº/ç®¡ç†å‘˜        | `!ç§»é™¤ç´¢å¼•ä»“åº“ repoId`                  | `/codeprid-del repoId`                  | é€šè¿‡ä»“åº“IDç§»é™¤         |
| æŸ¥çœ‹ä»“åº“æ±            | ä¸»äºº/ç®¡ç†å‘˜        | `!ä»“åº“æ± åˆ—è¡¨`                           | `/codep-list` æˆ– `/codep-l`             | æŸ¥çœ‹ä»“åº“æ±              |
| **ç¾¤ç»„è®¢é˜…ç®¡ç†**     |                    |                                         |                                         |                        |
| è®¢é˜…ä»“åº“             | ä¸»äºº/ç®¡ç†å‘˜        | `!è®¢é˜…ä»“åº“ repoUrl`                     | `/codes-sub repoUrl`                    | è®¢é˜…ä»“åº“åŠ¨æ€           |
| è®¢é˜…ä»“åº“æ± çš„ç´¢å¼•ä»“åº“ | ä¸»äºº/ç®¡ç†å‘˜        | `!è®¢é˜…ç´¢å¼•ä»“åº“ repoId`                  | `/codesrid-sub repoId`                  | é€šè¿‡ä»“åº“IDè®¢é˜…         |
| å–æ¶ˆè®¢é˜…             | ä¸»äºº/ç®¡ç†å‘˜        | `!å–æ¶ˆè®¢é˜… repoUrl`                     | `/codes-del repoUrl`                    | é€šè¿‡URLå–æ¶ˆ            |
| å–æ¶ˆç¼–å·è®¢é˜…         | ä¸»äºº/ç®¡ç†å‘˜        | `!å–æ¶ˆè®¢é˜…ç¼–å· subId`                   | `/codessid-del subId`                   | é€šè¿‡è®¢é˜…ç¼–å·å–æ¶ˆ       |
| å¼€å¯æ¨é€             | ä¸»äºº/ç®¡ç†å‘˜        | `!å¼€å¯æ¨é€ç¼–å· subId`                   | `/codessid-start subId`                 | å¼€å¯æŒ‡å®šè®¢é˜…æ¨é€       |
| æš‚åœæ¨é€             | ä¸»äºº/ç®¡ç†å‘˜        | `!æš‚åœæ¨é€ç¼–å· subId`                   | `/codessid-stop subId`                  | æš‚åœæŒ‡å®šè®¢é˜…æ¨é€       |
| å¼€å¯å…¨éƒ¨æ¨é€         | ä¸»äºº/ç®¡ç†å‘˜        | `!å¼€å¯æœ¬ç¾¤æ‰€æœ‰æ¨é€`                     | `/codes-start`                          | å¼€å¯æœ¬ç¾¤æ‰€æœ‰æ¨é€       |
| æš‚åœå…¨éƒ¨æ¨é€         | ä¸»äºº/ç®¡ç†å‘˜        | `!å…³é—­æœ¬ç¾¤æ‰€æœ‰æ¨é€`                     | `/codes-stop`                           | æš‚åœæœ¬ç¾¤æ‰€æœ‰æ¨é€       |
| ç™½åå•ç®¡ç†           | ä¸»äºº/ç®¡ç†å‘˜        | `!æ·»åŠ ç™½åå• @user` `!ç§»é™¤ç™½åå• @user` | `/codew-add @user` `/codew-del @user`   | ç®¡ç†ç™½åå•ç”¨æˆ·         |
| æŸ¥çœ‹ç™½åå•           | ä¸»äºº/ç®¡ç†å‘˜        | `!ç™½åå•åˆ—è¡¨`                           | `/codew-list`                           | æŸ¥çœ‹ç™½åå•åˆ—è¡¨         |
| **è·¨ç¾¤ç»„ç®¡ç†**       |                    |                                         |                                         |                        |
| è·¨ç¾¤å–æ¶ˆè®¢é˜…         | ä¸»äºº/å…¨å±€ç®¡ç†å‘˜    | `!è·¨ç¾¤å–æ¶ˆè®¢é˜… subId`                   | `/codesid-del subId`                    | è·¨ç¾¤ç§»é™¤è®¢é˜…           |
| è·¨ç¾¤å¼€å¯æ¨é€         | ä¸»äºº/å…¨å±€ç®¡ç†å‘˜    | `!è·¨ç¾¤å¼€å¯æ¨é€ subId`                   | `/codessid-start subId`                 | è·¨ç¾¤å¼€å¯æ¨é€           |
| è·¨ç¾¤æš‚åœæ¨é€         | ä¸»äºº/å…¨å±€ç®¡ç†å‘˜    | `!è·¨ç¾¤æš‚åœæ¨é€ subId`                   | `/codessid-stop subId`                  | è·¨ç¾¤æš‚åœæ¨é€           |
| æŸ¥çœ‹å…¨éƒ¨è®¢é˜…         | ä¸»äºº/å…¨å±€ç®¡ç†å‘˜    | `!å…¨éƒ¨è®¢é˜…åˆ—è¡¨`                         | `/codesg-list`                          | æŸ¥çœ‹æ‰€æœ‰è®¢é˜…           |
| **æƒé™ç®¡ç†**         |                    |                                         |                                         |                        |
| ç®¡ç†å‘˜æ“ä½œ           | ä¸»äºº               | `!æ–°å¢ç®¡ç†å‘˜ @user` `!åˆ é™¤ç®¡ç†å‘˜ @user` | `/codesm-add @user` `/codesm-del @user` | ç®¡ç†ç¾¤ç»„ç®¡ç†å‘˜         |
| å…¨å±€ç®¡ç†å‘˜æ“ä½œ       | ä¸»äºº               | `!æ–°å¢å…¨å±€ç®¡ç†å‘˜ @user`                 | `/codegm-add @user`                     | ç®¡ç†å…¨å±€ç®¡ç†å‘˜         |
| ç§»é™¤ç®¡ç†å‘˜è§’è‰²       | ä¸»äºº               | `!ç§»é™¤ç®¡ç†å‘˜è§’è‰² @user`                 | `/codem-del @user`                      | åŒæ—¶ç§»é™¤ä¸¤ç§ç®¡ç†å‘˜è§’è‰² |
| æŸ¥çœ‹ç®¡ç†å‘˜           | ä¸»äºº               | `!ç®¡ç†å‘˜åˆ—è¡¨`                           | `/codem-list`                           | æŸ¥çœ‹ç®¡ç†å‘˜åˆ—è¡¨         |
| é‡ç½®ç®¡ç†å‘˜ç³»ç»Ÿ       | ä¸»äºº               | `!é‡ç½®ç®¡ç†å‘˜ç³»ç»Ÿ`                       | `/codem-rm-rf`                          | æ¸…ç©ºæ‰€æœ‰ç®¡ç†å‘˜         |

## å››ã€ğŸˆè¿æ¥è¯´æ˜

æä¾›äº†2ç§æ–¹å¼è®¢é˜…githubä»“åº“

### 1. webhook

ç›´æ¥åœ¨å…·æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨ä¸Šï¼Œæ¥æ”¶æ¥è‡ªgithub webhookæ¶ˆæ¯ã€‚

> è¿™æ˜¯æœºå™¨äººçš„é»˜è®¤æ¨¡å¼ã€‚

- é…ç½®æ–‡ä»¶`alemomn.config.yaml`ï¼š

```yaml
alemonjs-code:
    github_secret: 'subscribe-code' # éœ€Github Webhooké…ç½®æ—¶å¡«å†™çš„ä¸€è‡´
    webhook_port: 18666 # Github WebhookæœåŠ¡ç«¯å£ï¼Œä¸Github Webhookçš„urlæ—¶å¡«å†™çš„ä¸€è‡´
    ws_secret: 'subscribe-ws' # å¯†é’¥ï¼ˆé€‰å¡«ï¼Œä»…å¯æœåŠ¡å™¨ï¼Œä¸å¯æœºå™¨äººæ—¶å¯é…ï¼‰
```

- å¯åŠ¨æœåŠ¡å™¨å’Œæœºå™¨äºº

```sh
yarn dev --login onebot
# release ç‰ˆ
yarn app --login onebot
```

- ä»…å¯æœåŠ¡å™¨ï¼Œä¸å¯æœºå™¨äºº

ç”¨æ¥å½“ä½œwebscoketçš„æœåŠ¡å™¨æ—¶

```sh
yarn dev --server
# release ç‰ˆ
yarn server
```

### 2. websocket

ä½¿ç”¨wsåè®®ï¼Œè¿æ¥å…¬ç½‘IPçš„æœåŠ¡å™¨ï¼Œè®©ä¸å…·å¤‡å…¬ç½‘IPçš„è®¾å¤‡å…·æœ‰æ¶ˆæ¯æ¥æ”¶èƒ½åŠ›ã€‚

- é…ç½®æ–‡ä»¶`alemomn.config.yaml`ï¼š

```yaml
alemonjs-code:
    # è¯¥é…ç½®ä¸ºéç©ºæ—¶ï¼Œå°†å¯åŠ¨wsè¿æ¥ä½¿ç”¨ä¸­è½¬æ¨¡å¼
    ws_server_url: ws://127.0.0.1:18666 # è¿æ¥åœ°å€ ï¼ˆç«¯å£è¦å’ŒæœåŠ¡ä¸Šçš„ä¸€è‡´ï¼‰
    ws_secret: 'subscribe-ws' # å¯†é’¥ï¼ˆè¦å’Œwsä¸Šé…ç½®çš„ws_secretä¸€è‡´ï¼‰
```

```sh
yarn dev --login onebot # å¯åŠ¨OneBotæœºå™¨äºº
# release ç‰ˆ
yarn app --login onebot
```

## å¼€å‘

å¼€å‘æ–‡æ¡£ [https://lvyjs.dev/ ](https://lvyjs.dev/)

ä½¿ç”¨æ–‡æ¡£ [https://alemonjs.com/](https://alemonjs.com/)

- ä»£ç è´¡çŒ®æŒ‡å—

[README_DEV](./README_DEV.md)
